<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>iMapInvasives App</title>
<link rel="stylesheet" href="css/jquery.mobile-1.3.1.css">
<link rel="stylesheet" href="css/style.mobile.css" type="text/css">

<!-- Extra Codiqa features -->
<link rel="stylesheet" href="css/codiqa.ext.css">
<link rel="stylesheet" href="css/jquery.ui.datepicker.mobile.css">

<!-- jQuery and jQuery Mobile -->
<script type="text/javascript" src="js/jQuery.datepicker.js"></script>
<script type="text/javascript" src="js/jQuery.datepicker.mobile.js"></script>
<script type="text/javascript" src="js/cordova-2.7.0.js"></script>
<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="js/jquery.mobile-1.3.2.min.js"></script>
<script type="text/javascript" src="js/json.js"></script>
<script type="text/javascript" src="js/index.js"></script>
<script type="text/javascript" src="js/observation.js"></script>
<script type="text/javascript" src="js/prefs.js"></script>
<script type="text/javascript" src="js/SQLitePlugin.js"></script>
<script type="text/javascript" src="js/db.js"></script>
<script type="text/javascript" src="js/photo.js"></script>
<script type="text/javascript" src="js/OpenLayers.mobile.js"></script>
<script type="text/javascript" src="js/MapStuff.js"></script>
<script type="text/javascript">
  var selected;
  var screenCon;
  var tab;
  var curObservation;
  	iMapApp.initialize();
  	function goHome(){
  		chooseSpec();
  		$('#header-text').text('');
  		$('#prefsScreen').hide();
  		$('#getLoca').hide();
		$('#takePic').hide();
		$('#getDate').hide();
		$('#getProj').hide();
		$('#getSpec').hide();
		$('#listProj').hide();
		$('#navi').hide();
		$('#listSpec').hide();
		$('#button-footer').hide();
		$('#homescreen').show();
  	}
  	function tabPhoto(){
  		//selected = "<h2>Select or Take a Photo</h2><input onClick='previewPhoto()' type='file'  id='imageName' name='image' accept='image/*' capture><p><button onClick='getPhoto()'>Take Photo</button><img style='display:none;width:160px;height:200px;' id='largeImage' src='' />";
  		//$('#head').empty();
  		//$('#head').append($(selected)).trigger( "create" );
		tab='photo';
		$('#pic').addClass("ui-btn-active").trigger("create");
		$('#header-text').text('Select a Photo');
		$('#navi').show();
		$('#homescreen').hide();
		$('#listProj').hide();
		$('#getLoca').hide();
		$('#takePic').show();
		$('#listSpec').hide();
		$('#getDate').hide();
		$('#getProj').hide();
		$('#getSpec').hide();
		$('#button-footer').show();
  	}
	function tabWhere(){
  		//selected = "<h2>Your Location</h2><img src='https://maps.googleapis.com/maps/api/staticmap?center=Albany, NY&amp;zoom=10&amp;size=288x200&amp;markers=Albany,NY&amp;sensor=false'width='288' height='200'>";
  		//$('#head').empty();
  		//$('#head').append($(selected)).trigger( "create" );
  		tab='where';
  		$('#header-text').text('Your Location');
  		$('#getLoca').show();
  		$('#listProj').hide();
		$('#takePic').hide();
		$('#listSpec').hide();
		$('#getDate').hide();
		$('#getProj').hide();
		$('#getSpec').hide();
	}
	function tabWhat(){
		//selected = "<h2>What Species</h2><div data-role='fieldcontain' id='what'><label for='selectmenu1'>Choose:</label><select id='selectmenu1' name=''><option value='option1'>Specie 1</option><option value='value'>Specie 2</option></select></div>";
		//$('#head').empty();
		//$('#head').append($(selected)).trigger( "create" );
		tab='what';
		$('#header-text').text('What Species');
		$('#getLoca').hide();
		$('#listProj').hide();
		$('#takePic').hide();
		$('#listSpec').show();
		$('#getDate').hide();
		$('#getProj').hide();
	}
	function tabProject(){
		//selected = "<h2>Project</h2><div data-role='fieldcontain' id='proj'><fieldset data-role='controlgroup' data-type='vertical'><legend>Is this entry part of a project?</legend><input id='radioYes' name='' value='yes' data-theme='c' type='radio'><label for='radioYes'>Yes</label><input id='radioNo' name='' value='radioNo' data-theme='c' type='radio'><label for='radioNo'>No</label></fieldset></div>";
		tab='project';
		//$('#head').empty();
		//$('#head').append($(selected)).trigger( "create" );
		$('#header-text').text('Select Project');
		$('#getLoca').hide();
		$('#takePic').hide();
		$('#listSpec').hide();
		$('#listProj').show();
		$('#getDate').hide();
		$('#getProj').show();
		$('#getSpec').hide();
	}
	function tabWhen(){
		//selected = "<h2>Date Recorded</h2><div data-role='fieldcontain' id='date'><label for='textinput1'>Date</label><input name='' id='textinput1' placeholder='' value='' type='text'></div>";
		//$('#head').empty();
		//$('#head').append($(selected)).trigger( "create" );
		tab = 'when';
		$('#header-text').text('Observation Date');
		$('#dateField').val(curObservation.When);
		$('#getLoca').hide();
		$('#takePic').hide();
		$('#listProj').hide();
		$('#listSpec').hide();
		$('#getDate').show();
		$('#getProj').hide();
		$('#getSpec').hide();
	}
	
	$(document).on("swiperight", function(){
		  if(tab=="project"){
			  $('#proj').removeClass("ui-btn-active").trigger("create");
				$('#pic').addClass("ui-btn-active").trigger("create");
			  tabPhoto();
		  }
		  else if(tab=="what"){
			 
			  $('#wha').removeClass("ui-btn-active").trigger("create");
			$('#proj').addClass("ui-btn-active").trigger("create");
			  tabProject();
		  }
		  else if(tab=="when"){
			  $('#whe').removeClass("ui-btn-active").trigger("create");
			  $('#wha').addClass("ui-btn-active").trigger("create");
			  tabWhat();
		  }
		  else if(tab=="where"){
			  $('#wher').removeClass("ui-btn-active").trigger("create");
			  $('#whe').addClass("ui-btn-active").trigger("create");
			 tabWhen();
		  }
	})
	$(document).on("swipeleft", function(){
		  if(tab=="photo"){
			  $('#proj').addClass("ui-btn-active").trigger("create");
				$('#pic').removeClass("ui-btn-active").trigger("create");
			  tabProject();
		  }
		  else if(tab=="project"){
			  tabWhat();
			  $('#proj').removeClass("ui-btn-active").trigger("create");
				$('#wha').addClass("ui-btn-active").trigger("create");
		  }
		  else if(tab=="what"){
			  $('#wha').removeClass("ui-btn-active").trigger("create");
				$('#whe').addClass("ui-btn-active").trigger("create");
			  tabWhen();
		  }
		  else if(tab=="when"){
			  $('#whe').removeClass("ui-btn-active").trigger("create");
				$('#wher').addClass("ui-btn-active").trigger("create");
			  tabWhere();
		  }
	  })
	  function chooseSpec(){
		//if(iMapPrefs.params.Plants.UseCommon == "true" && iMapPrefs.params.Plants.UseScientific == "true" && iMapPrefs.params.Plants.MyPlants.length == 0){
			$('#listSpec').show();
			$('#header-text').text('What Specie are you Recording?').trigger("create");
			selected = "<div data-role='fieldcontain' id='what'><label for='selectmenu1'>Choose:</label><select id='selectmenu1' name=''>";
			for(var i=0;i<DBFuncs.SpeciesList.length;i++){
				selected+="<option value="+i+">"+DBFuncs.SpeciesList[i]+"</option>";
			}
			selected += "</select></div>";
		//}
		/* if(iMapPrefs.params.Plants.UseCommon == "false" && iMapPrefs.params.Plants.UseScientific == "true" && iMapPrefs.params.Plants.MyPlants.length == 0){
			$('#listSpec').show();
			selected = "<h2>What Specie are you Recording?</h2><div data-role='fieldcontain' id='what'><label for='selectmenu1'>Choose:</label><select id='selectmenu1' name=''>";
			for(var i=0;i<DBFuncs.SpeciesList.length;i++){
				selected+="<option value='option"+i+"'>"+DBFuncs.SpeciesList[i][1]+"</option>";
			}
			selected += "</select></div>";
		}
		if(iMapPrefs.params.Plants.UseCommon == "true" && iMapPrefs.params.Plants.UseScientific == "false" && iMapPrefs.params.Plants.MyPlants.length == 0){
			$('#listSpec').show();
			selected = "<h2>What Specie are you Recording?</h2><div data-role='fieldcontain' id='what'><label for='selectmenu1'>Choose:</label><select id='selectmenu1' name=''>";
			for(var i=0;i<DBFuncs.SpeciesList.length;i++){
				selected+="<option value='option"+i+"'>"+DBFuncs.SpeciesList[i]+"</option>";
			}
			selected += "</select></div>";
		}
		if(iMapPrefs.params.Plants.MyPlants.length != 0){
			$('#listSpec').show();
			selected = "<h2>What Specie are you Recording?</h2><div data-role='fieldcontain' id='what'><label for='selectmenu1'>Choose:</label><select id='selectmenu1' name=''>";
			for(var i=0;i<DBFuncs.MyPlants.length;i++){
				selected+="<option value='option"+i+"'>"+iMapPrefs.params.Plants.MyPlants[i]+"</option>";
			}
			selected += "</select></div>";
		} */
		$('#listSpec').empty();
  		$('#listSpec').append($(selected)).trigger( "create" );
	}
	  function chooseProj(){
		$('#listProj').show();
		selected = "<div data-role='fieldcontain' id='what'><label for='selectmenu1'>Choose:</label><select id='selectmenu1' name=''>";
		for(var i=0;i<DBFuncs.ProjectList.length;i++){
			selected+="<option value='option"+i+"'>"+DBFuncs.ProjectList[i]+"</option>";
		}
		selected += "</select></div>";
		$('#listProj').empty();
  		$('#listProj').append($(selected)).trigger( "create" );
	}
	function noChoose(){
		$('#listProj').hide();
	}
 	function editObs(){}
	function prefsHome(){
		$('#fname').val(iMapPrefs.params.Firstname);
		$('#lname').val(iMapPrefs.params.Lastname);
		$('#uname').val(iMapPrefs.params.Username);
		$('#pword').val(iMapPrefs.params.Password);
		//iMapPrefs.params.Projects = $('#fname').val();
		$('#checkbox-common').attr('checked', iMapPrefs.params.Plants.UseCommon).checkboxradio("refresh");
		$('#checkbox-scientific').attr('checked', iMapPrefs.params.Plants.UseScientific).checkboxradio("refresh");
		//iMapPrefs.params.Plants.MyPlants = $('#fname').val();
		//iMapPrefs.params.PictureSize = $("input[name=radio-choice-size]:checked").val();
		$('#'+iMapPrefs.params.PictureSize).attr('checked', true).checkboxradio("refresh");
		//alert($.toJSON(iMapPrefs));
		$('#prefsScreen').show();
		$('#homescreen').hide();
	}
	// Save the current observation.
	// First set the curObservation fieldw then call save.
	function saveObservation() {
		//alert($("#listProj :selected").text());
		var methods = [],
		    obj = $('#listSpec').find('#selectmenu1 :selected');
		//alert(obj.val());
		curObservation.Project = $("#listProj :selected").text(); // $("selectmenu1");
		curObservation.Species = DBFuncs.SpeciesList[obj.val()];
		//curObservation.When = $('#dateField').val();
		curObservation.save(curObservation);
		goHome();
	}
	// Save the current preferences fromt he screen
	function savePrefs() {
		iMapPrefs.params.Firstname = $('#fname').val();
		iMapPrefs.params.Lastname = $('#lname').val();
		iMapPrefs.params.Username = $('#uname').val();	
		iMapPrefs.params.Password = $('#pword').val();
		//iMapPrefs.params.Projects = $('#fname').val();
		iMapPrefs.params.Plants.UseCommon = $('#checkbox-common').is(':checked'); 
		iMapPrefs.params.Plants.UseScientific = $('#checkbox-scientific').is(':checked');
		//iMapPrefs.params.Plants.MyPlants = $('#fname').val();
		iMapPrefs.params.PictureSize = $("input[name=radio-choice-size]:checked").val();
		//alert($.toJSON(iMapPrefs));
		iMapPrefs.saveParams();
		goHome();
	}
    </script>
<style>
html,body {
	margin: 0;
	padding: 0;
	height: 100%;
	width: 100%;
}

@media only screen and (max-width: 600px) {
	html,body {
		height: 117%;
	}
}

#getLoca, #page-content-div #iMapMapdiv {
	width: 100%;
	height: 100%;
}

.olControlAttribution {
	position: absolute;
	font-size: 10px;
	bottom: 0 !important;
	right: 0 !important;
	background: rgba(0, 0, 0, 0.1);
	font-family: Arial;
	padding: 2px 4px;
	border-radius: 5px 0 0 0;
}

#title,#tags,#shortdesc {
	display: none;
}
</style>
</head>
<body>
	<div data-role="page" id="page1">
		<img src="img/iMapHeader.gif"
			style="width: 99.5%; height: 60px; TOP: 0px; LEFT: 0px">

		<div data-theme="a" data-role="header">
			<p class="ui-title" id="header-text"></p>

			<div id="getout">

				<div id="navi" data-role="navbar" data-iconpos="left">
					<ul>
						<li><a id="pic" href="#page1" data-transition="none"
							data-theme="" onClick="tabPhoto()"> Photo </a></li>
						<li><a id="proj" href="#page1" data-transition="none"
							data-theme="" onClick="tabProject()"> Project </a></li>
						<li><a href="#page1" id="wha" data-transition="fade"
							data-theme="" onClick="tabWhat()"> What </a></li>
						<li><a href="#page1" id="whe" data-transition="none"
							data-theme="" onClick="tabWhen()"> When </a></li>
						<li><a href="#page1" id="wher" data-transition="none"
							data-theme="" onClick="tabWhere()"> Where </a></li>
					</ul>
				</div>
			</div>

		</div>

		<div id='page-content-div' data-role="content">
			<div id="homescreen">
				<button onClick="curObservation = new iMapObservation();tabPhoto()">Make
					Observation</button>
				<button onClick="editObs()">Edit Observation</button>
				<button onClick="prefsHome()">Preferences</button>
			</div>
			<div id="takePic">
				<input onClick='previewPhoto()' type='file' id='imageName'
					name='image' accept='image/*'>
				<p>
					<button onClick='getPhoto()'>Take Photo</button>
					<img style='display: none; width: 160px; height: 200px;'
						id='largeImage' src='' />
			</div>
			<div id="getLoca">
				<div id="iMapMapdiv" style="height: 300px; width: 300px;"></div>
			</div>
			<div id="getDate">
				<h2>Date Recorded</h2>
				<div data-role='fieldcontain' id='dateDiv'>
					<label for="dateField">Date Recorded:</label> <input type="date"
						name="dateField" id="dateField" value="" />
				</div>
			</div>
			<div id="getProj">
				<div data-role='fieldcontain' id='proj'>
					<fieldset data-role='controlgroup' data-type='vertical'>
						<legend>Is this entry part of a project?</legend>
						<input id='radioYes' name='' value='yes' data-theme='c'
							type='radio' onClick="chooseProj()"> <label
							for='radioYes'>Yes</label> <input id='radioNo' name=''
							value='radioNo' data-theme='c' type='radio' onClick="noChoose()">
						<label for='radioNo'>No</label>
					</fieldset>
				</div>
			</div>
			<div id="getSpec">
				<div data-role='fieldcontain' id='what'>
					<label for='selectmenu1'>Choose:</label> <select id='selectmenu1'
						name=''>
						<option value='option1'>Specie 1</option>
						<option value='value'>Specie 2</option>
					</select>
				</div>
			</div>
			<div id="listProj"></div>
			<div id="listSpec"></div>
			<div id="prefsScreen">

				<h2>Preferences</h2>
				<div data-role="fieldcontain">
					<label for="fname">First Name:</label> 
					<input type="text"	name="fname" id="fname" value="" /> 
					<label for="lname">Last	Name:</label> 
					<input type="text" name="lname" id="lname" value="" /> 
					<label for="uname">User Name:</label> 
					<input type="text" name="uname"	id="uname" value="" /> 
					<label for="pword">Password:</label> 
					<input type="password" name="pword" id="pword" value="" />
					<fieldset data-role="controlgroup">
						<legend>What should we display:</legend>
						<input type="checkbox" name="checkbox-scientific" id="checkbox-scientific" class="custom" /> 
						<label for="checkbox-scientific">Scientific</label> 
						<input type="checkbox" name="checkbox-common" id="checkbox-common" class="custom" /> 
						<label for="checkbox-common">Common</label>
					</fieldset>
					<button onClick="ChooseMySpecies()">Choose Specific	Species</button>
					<fieldset data-role='controlgroup' data-type='vertical'	id='pictureSize'>
						<legend>Picture Size:</legend>
						<input id='small' name='radio-choice-size' value='small' data-theme='c' type='radio'> 
						<label for='small'>Small</label>
						<input id='medium' name='radio-choice-size' value='medium' data-theme='c' type='radio'> 
						<label for='medium'>Medium</label>
						<input id='large' name='radio-choice-size' value='large' data-theme='c' type='radio'> 
						<label for='large'>Large</label>
					</fieldset>
					<div id='button-prefs' data-role='footer' class="ui-bar">
						<a href='#page1' data-role='button' onclick="savePrefs()">Save</a>
						<a href='#page1' data-role='button' onclick="goHome()">Cancel</a>
					</div>
				</div>
			</div>
		</div>
		<div id='button-footer' data-role='footer' class="ui-bar">
			<a href='#page1' data-role='button' onclick="saveObservation()">Save</a>
			<a href='#page1' data-role='button' onclick="goHome()">Cancel</a>
		</div>
	</div>
</body>
</html>
